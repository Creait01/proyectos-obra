<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template principal del reporte -->
    <template id="report_cash_register_close">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="cash_register_close.report_cash_register_close_document"/>
            </t>
        </t>
    </template>

    <!-- Documento del reporte - TODO con estilos inline para PDF -->
    <template id="report_cash_register_close_document">
        <t t-call="web.external_layout">
            <t t-set="doc" t-value="doc"/>
            
            <div class="page" style="font-family: Arial, sans-serif; font-size: 12px;">
                
                <!-- Encabezado del reporte - SIN l√≠neas blancas -->
                <div style="background-color: #2c3e50; color: white; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h1 style="margin: 0; font-size: 24px; color: white;">CIERRE DE CAJA DIARIO</h1>
                            <p style="margin: 5px 0 0 0; color: #bdc3c7;">
                                <t t-esc="doc.company_id.name"/>
                            </p>
                        </div>
                        <div style="text-align: right;">
                            <span t-if="doc.state == 'confirmed'" 
                                  style="background-color: #3498db; color: white; padding: 8px 15px; border-radius: 20px; font-size: 11px;">
                                ‚úì‚úì CONFIRMADO
                            </span>
                            <span t-elif="doc.state == 'closed'" 
                                  style="background-color: #27ae60; color: white; padding: 8px 15px; border-radius: 20px; font-size: 11px;">
                                ‚úì CERRADO
                            </span>
                            <span t-elif="doc.state == 'in_progress'" 
                                  style="background-color: #f39c12; color: white; padding: 8px 15px; border-radius: 20px; font-size: 11px;">
                                ‚è≥ EN PROCESO
                            </span>
                            <span t-elif="doc.state == 'cancelled'" 
                                  style="background-color: #e74c3c; color: white; padding: 8px 15px; border-radius: 20px; font-size: 11px;">
                                ‚úó CANCELADO
                            </span>
                            <span t-else="" 
                                  style="background-color: #95a5a6; color: white; padding: 8px 15px; border-radius: 20px; font-size: 11px;">
                                BORRADOR
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n general - UNA SOLA L√çNEA -->
                <div style="background-color: #f8f9fa; padding: 12px 20px; margin-bottom: 20px; border-radius: 8px; border-left: 5px solid #3498db;">
                    <table style="width: 100%; font-size: 11px;">
                        <tr>
                            <td><span style="color: #7f8c8d;">Ref:</span> <strong><t t-esc="doc.name"/></strong></td>
                            <td><span style="color: #7f8c8d;">Fecha:</span> <strong><t t-esc="doc.date" t-options="{'widget': 'date'}"/></strong></td>
                            <td><span style="color: #7f8c8d;">Responsable:</span> <strong><t t-esc="doc.user_id.name"/></strong></td>
                            <td><span style="color: #7f8c8d;">Cuentas:</span> <strong><t t-esc="doc.accounts_count"/></strong></td>
                            <td><span style="color: #7f8c8d;">Distribuci√≥n:</span> <strong><t t-esc="doc.accounts_bs_count"/> Bs / <t t-esc="doc.accounts_usd_count"/> USD / <t t-esc="doc.accounts_eur_count"/> EUR</strong></td>
                        </tr>
                    </table>
                </div>

                <!-- ======================= -->
                <!-- RESUMEN EN BOL√çVARES    -->
                <!-- ======================= -->
                <div style="margin-bottom: 20px; border: 2px solid #27ae60; border-radius: 8px; overflow: hidden;">
                    <div style="background-color: #27ae60; color: white; padding: 10px 15px; font-weight: bold;">
                        üí∞ Resumen en Bol√≠vares (Bs)
                    </div>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Saldo Inicial</div>
                                <div style="font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 5px;">
                                    <t t-esc="'{:,.2f}'.format(doc.total_initial_balance_bs)"/> Bs
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">+ Ingresos</div>
                                <div style="font-size: 16px; font-weight: bold; color: #27ae60; margin-top: 5px;">
                                    <t t-esc="'{:,.2f}'.format(doc.total_income_bs)"/> Bs
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">- Egresos</div>
                                <div style="font-size: 16px; font-weight: bold; color: #e74c3c; margin-top: 5px;">
                                    <t t-esc="'{:,.2f}'.format(doc.total_expense_bs)"/> Bs
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Saldo Final</div>
                                <div style="font-size: 16px; font-weight: bold; color: #3498db; margin-top: 5px;">
                                    <t t-esc="'{:,.2f}'.format(doc.total_final_balance_bs)"/> Bs
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Contado</div>
                                <div style="font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 5px;">
                                    <t t-esc="'{:,.2f}'.format(doc.total_counted_bs)"/> Bs
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Diferencia</div>
                                <div style="font-size: 16px; font-weight: bold; margin-top: 5px;"
                                     t-attf-style="color: #{doc.total_difference_bs &lt; 0 and '#e74c3c' or (doc.total_difference_bs == 0 and '#3498db' or '#f39c12')};">
                                    <t t-esc="'{:,.2f}'.format(doc.total_difference_bs)"/> Bs
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- ======================= -->
                <!-- RESUMEN EN USD          -->
                <!-- ======================= -->
                <div style="margin-bottom: 20px; border: 2px solid #3498db; border-radius: 8px; overflow: hidden;">
                    <div style="background-color: #3498db; color: white; padding: 10px 15px; font-weight: bold;">
                        üíµ Resumen en D√≥lares (USD)
                    </div>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Saldo Inicial</div>
                                <div style="font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 5px;">
                                    $ <t t-esc="'{:,.2f}'.format(doc.total_initial_balance_usd)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">+ Ingresos</div>
                                <div style="font-size: 16px; font-weight: bold; color: #27ae60; margin-top: 5px;">
                                    $ <t t-esc="'{:,.2f}'.format(doc.total_income_usd)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">- Egresos</div>
                                <div style="font-size: 16px; font-weight: bold; color: #e74c3c; margin-top: 5px;">
                                    $ <t t-esc="'{:,.2f}'.format(doc.total_expense_usd)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Saldo Final</div>
                                <div style="font-size: 16px; font-weight: bold; color: #3498db; margin-top: 5px;">
                                    $ <t t-esc="'{:,.2f}'.format(doc.total_final_balance_usd)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Contado</div>
                                <div style="font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 5px;">
                                    $ <t t-esc="'{:,.2f}'.format(doc.total_counted_usd)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Diferencia</div>
                                <div style="font-size: 16px; font-weight: bold; margin-top: 5px;"
                                     t-attf-style="color: #{doc.total_difference_usd &lt; 0 and '#e74c3c' or (doc.total_difference_usd == 0 and '#3498db' or '#f39c12')};">
                                    $ <t t-esc="'{:,.2f}'.format(doc.total_difference_usd)"/>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- ======================= -->
                <!-- RESUMEN EN EUR          -->
                <!-- ======================= -->
                <div style="margin-bottom: 20px; border: 2px solid #9b59b6; border-radius: 8px; overflow: hidden;">
                    <div style="background-color: #9b59b6; color: white; padding: 10px 15px; font-weight: bold;">
                        üí∂ Resumen en Euros (EUR)
                    </div>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Saldo Inicial</div>
                                <div style="font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 5px;">
                                    ‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_initial_balance_eur)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">+ Ingresos</div>
                                <div style="font-size: 16px; font-weight: bold; color: #27ae60; margin-top: 5px;">
                                    ‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_income_eur)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">- Egresos</div>
                                <div style="font-size: 16px; font-weight: bold; color: #e74c3c; margin-top: 5px;">
                                    ‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_expense_eur)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Saldo Final</div>
                                <div style="font-size: 16px; font-weight: bold; color: #9b59b6; margin-top: 5px;">
                                    ‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_final_balance_eur)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center; border-right: 1px solid #e0e0e0;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Contado</div>
                                <div style="font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 5px;">
                                    ‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_counted_eur)"/>
                                </div>
                            </td>
                            <td style="width: 16.66%; padding: 15px; text-align: center;">
                                <div style="font-size: 10px; color: #7f8c8d; text-transform: uppercase;">Diferencia</div>
                                <div style="font-size: 16px; font-weight: bold; margin-top: 5px;"
                                     t-attf-style="color: #{doc.total_difference_eur &lt; 0 and '#e74c3c' or (doc.total_difference_eur == 0 and '#9b59b6' or '#f39c12')};">
                                    ‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_difference_eur)"/>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- ======================= -->
                <!-- DETALLE POR CUENTA      -->
                <!-- ======================= -->
                <h3 style="color: #2c3e50; margin-top: 30px; margin-bottom: 15px; font-size: 16px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                    üìã Detalle por Cuenta de Efectivo
                </h3>

                <table style="width: 100%; border-collapse: collapse; font-size: 10px;">
                    <thead>
                        <tr style="background-color: #2c3e50; color: white;">
                            <th style="padding: 10px; text-align: left; border: 1px solid #34495e;">Cuenta</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #34495e;">Moneda</th>
                            <th style="padding: 10px; text-align: right; border: 1px solid #34495e;">Inicio</th>
                            <th style="padding: 10px; text-align: right; border: 1px solid #34495e;">Ingresos</th>
                            <th style="padding: 10px; text-align: right; border: 1px solid #34495e;">Egresos</th>
                            <th style="padding: 10px; text-align: right; border: 1px solid #34495e;">Final</th>
                            <th style="padding: 10px; text-align: right; border: 1px solid #34495e;">Contado</th>
                            <th style="padding: 10px; text-align: right; border: 1px solid #34495e;">Diferencia</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="doc.line_ids" t-as="line">
                            <tr t-attf-style="background-color: #{line_odd and '#f8f9fa' or '#ffffff'};">
                                <td style="padding: 8px; border: 1px solid #e0e0e0; text-align: left;">
                                    <strong><t t-esc="line.account_id.code"/></strong><br/>
                                    <span style="font-size: 9px; color: #7f8c8d;"><t t-esc="line.account_id.name"/></span>
                                </td>
                                <td style="padding: 8px; border: 1px solid #e0e0e0; text-align: center;">
                                    <span t-if="line.is_usd_account" 
                                          style="background-color: #3498db; color: white; padding: 2px 8px; border-radius: 10px; font-size: 9px;">USD</span>
                                    <span t-elif="line.is_eur_account" 
                                          style="background-color: #9b59b6; color: white; padding: 2px 8px; border-radius: 10px; font-size: 9px;">EUR</span>
                                    <span t-else="" 
                                          style="background-color: #27ae60; color: white; padding: 2px 8px; border-radius: 10px; font-size: 9px;">Bs</span>
                                </td>
                                <td style="padding: 8px; border: 1px solid #e0e0e0; text-align: right;">
                                    <t t-if="line.is_usd_account">$ </t>
                                    <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                    <t t-esc="'{:,.2f}'.format(line.initial_balance)"/>
                                    <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                </td>
                                <td style="padding: 8px; border: 1px solid #e0e0e0; text-align: right; color: #27ae60;">
                                    <t t-if="line.is_usd_account">$ </t>
                                    <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                    <t t-esc="'{:,.2f}'.format(line.total_income)"/>
                                    <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                </td>
                                <td style="padding: 8px; border: 1px solid #e0e0e0; text-align: right; color: #e74c3c;">
                                    <t t-if="line.is_usd_account">$ </t>
                                    <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                    <t t-esc="'{:,.2f}'.format(line.total_expense)"/>
                                    <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                </td>
                                <td style="padding: 8px; border: 1px solid #e0e0e0; text-align: right; font-weight: bold;">
                                    <t t-if="line.is_usd_account">$ </t>
                                    <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                    <t t-esc="'{:,.2f}'.format(line.final_balance)"/>
                                    <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                </td>
                                <td style="padding: 8px; border: 1px solid #e0e0e0; text-align: right;">
                                    <t t-if="line.is_usd_account">$ </t>
                                    <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                    <t t-esc="'{:,.2f}'.format(line.counted_amount)"/>
                                    <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                </td>
                                <td style="padding: 8px; border: 1px solid #e0e0e0; text-align: right;"
                                    t-attf-style="color: #{line.difference &lt; 0 and '#e74c3c' or (line.difference &gt; 0 and '#f39c12' or '#27ae60')}; font-weight: bold;">
                                    <t t-if="line.is_usd_account">$ </t>
                                    <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                    <t t-esc="'{:,.2f}'.format(line.difference)"/>
                                    <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>

                <!-- ================================= -->
                <!-- DETALLE DE DENOMINACIONES         -->
                <!-- ================================= -->
                <div style="page-break-before: always;">
                    <h3 style="color: #2c3e50; margin-top: 30px; margin-bottom: 15px; font-size: 16px; border-bottom: 2px solid #f39c12; padding-bottom: 10px;">
                        üè¶ Detalle de Denominaciones por Cuenta
                    </h3>
                    
                    <t t-foreach="doc.line_ids" t-as="line">
                        <t t-if="line.denomination_line_ids or line.bad_bills_ids">
                            <div style="page-break-inside: avoid; margin-bottom: 25px;">
                                <!-- Encabezado de la cuenta -->
                                <div t-attf-style="background: linear-gradient(135deg, #{line.is_usd_account and '#27ae60' or (line.is_eur_account and '#9b59b6' or '#3498db')} 0%, #{line.is_usd_account and '#2ecc71' or (line.is_eur_account and '#8e44ad' or '#2980b9')} 100%); 
                                                  color: white; padding: 10px 15px; border-radius: 8px 8px 0 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="font-weight: bold; font-size: 12px;">
                                            <t t-esc="line.account_id.code"/> - <t t-esc="line.account_id.name"/>
                                        </span>
                                        <span style="background-color: rgba(255,255,255,0.2); padding: 3px 12px; border-radius: 15px; font-size: 10px;">
                                            <t t-if="line.is_usd_account">USD</t>
                                            <t t-elif="line.is_eur_account">EUR</t>
                                            <t t-else="">Bs</t>
                                        </span>
                                    </div>
                                </div>
                                
                                <div style="border: 1px solid #e0e0e0; border-top: none; border-radius: 0 0 8px 8px; padding: 15px;">
                                    <table style="width: 100%;">
                                        <tr>
                                            <!-- Denominaciones en buen estado -->
                                            <td style="width: 60%; vertical-align: top; padding-right: 15px;">
                                                <div style="background-color: #e8f5e9; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                                                    <h5 style="margin: 0 0 10px 0; color: #27ae60; font-size: 11px;">
                                                        ‚úì Denominaciones Contadas
                                                    </h5>
                                                    <t t-if="line.denomination_line_ids">
                                                        <table style="width: 100%; font-size: 9px; border-collapse: collapse;">
                                                            <thead>
                                                                <tr style="background-color: rgba(39,174,96,0.1);">
                                                                    <th style="padding: 5px; text-align: left; border-bottom: 1px solid #c8e6c9;">Denominaci√≥n</th>
                                                                    <th style="padding: 5px; text-align: center; border-bottom: 1px solid #c8e6c9;">Tipo</th>
                                                                    <th style="padding: 5px; text-align: center; border-bottom: 1px solid #c8e6c9;">Cantidad</th>
                                                                    <th style="padding: 5px; text-align: right; border-bottom: 1px solid #c8e6c9;">Subtotal</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <t t-set="total_denoms" t-value="0"/>
                                                                <t t-foreach="line.denomination_line_ids.filtered(lambda d: d.quantity > 0)" t-as="denom">
                                                                    <tr t-attf-style="background-color: #{denom_odd and '#ffffff' or '#f1f8e9'};">
                                                                        <td style="padding: 4px 5px; border-bottom: 1px solid #e8f5e9;">
                                                                            <t t-if="line.is_usd_account">$ </t>
                                                                            <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                                            <t t-esc="'{:,.2f}'.format(denom.denomination_value)"/>
                                                                            <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                                                        </td>
                                                                        <td style="padding: 4px 5px; text-align: center; border-bottom: 1px solid #e8f5e9;">
                                                                            <span t-if="denom.denomination_type == 'bill'" style="color: #27ae60;">üìÑ Billete</span>
                                                                            <span t-else="" style="color: #f39c12;">ü™ô Moneda</span>
                                                                        </td>
                                                                        <td style="padding: 4px 5px; text-align: center; border-bottom: 1px solid #e8f5e9; font-weight: bold;">
                                                                            <t t-esc="denom.quantity"/>
                                                                        </td>
                                                                        <td style="padding: 4px 5px; text-align: right; border-bottom: 1px solid #e8f5e9;">
                                                                            <t t-if="line.is_usd_account">$ </t>
                                                                            <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                                            <t t-esc="'{:,.2f}'.format(denom.total)"/>
                                                                            <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                                                        </td>
                                                                    </tr>
                                                                    <t t-set="total_denoms" t-value="total_denoms + denom.total"/>
                                                                </t>
                                                            </tbody>
                                                            <tfoot>
                                                                <tr style="background-color: #c8e6c9; font-weight: bold;">
                                                                    <td colspan="3" style="padding: 6px; text-align: right;">TOTAL DENOMINACIONES:</td>
                                                                    <td style="padding: 6px; text-align: right; color: #27ae60;">
                                                                        <t t-if="line.is_usd_account">$ </t>
                                                                        <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                                        <t t-esc="'{:,.2f}'.format(sum(line.denomination_line_ids.mapped('total')))"/>
                                                                        <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                                                    </td>
                                                                </tr>
                                                            </tfoot>
                                                        </table>
                                                    </t>
                                                    <t t-else="">
                                                        <p style="color: #7f8c8d; font-style: italic; font-size: 9px; margin: 0;">Sin denominaciones registradas</p>
                                                    </t>
                                                </div>
                                            </td>
                                            
                                            <!-- Billetes en mal estado -->
                                            <td style="width: 40%; vertical-align: top;">
                                                <div style="background-color: #fce4ec; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                                                    <h5 style="margin: 0 0 10px 0; color: #e74c3c; font-size: 11px;">
                                                        ‚ö†Ô∏è Billetes en Mal Estado
                                                    </h5>
                                                    <t t-if="line.bad_bills_ids">
                                                        <table style="width: 100%; font-size: 9px; border-collapse: collapse;">
                                                            <thead>
                                                                <tr style="background-color: rgba(231,76,60,0.1);">
                                                                    <th style="padding: 5px; text-align: left; border-bottom: 1px solid #f8bbd9;">Denom.</th>
                                                                    <th style="padding: 5px; text-align: center; border-bottom: 1px solid #f8bbd9;">Cond.</th>
                                                                    <th style="padding: 5px; text-align: center; border-bottom: 1px solid #f8bbd9;">Cant.</th>
                                                                    <th style="padding: 5px; text-align: right; border-bottom: 1px solid #f8bbd9;">Total</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <t t-foreach="line.bad_bills_ids.filtered(lambda b: b.quantity > 0)" t-as="bad">
                                                                    <tr t-attf-style="background-color: #{bad_odd and '#ffffff' or '#fce4ec'};">
                                                                        <td style="padding: 4px 5px; border-bottom: 1px solid #fce4ec;">
                                                                            <t t-if="line.is_usd_account">$ </t>
                                                                            <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                                            <t t-esc="'{:,.0f}'.format(bad.denomination_value)"/>
                                                                        </td>
                                                                        <td style="padding: 4px 5px; text-align: center; border-bottom: 1px solid #fce4ec; font-size: 8px;">
                                                                            <t t-if="bad.condition == 'damaged'">Da√±ado</t>
                                                                            <t t-elif="bad.condition == 'torn'">Roto</t>
                                                                            <t t-elif="bad.condition == 'worn'">Desgastado</t>
                                                                            <t t-elif="bad.condition == 'counterfeit'">Sospechoso</t>
                                                                            <t t-else="">Otro</t>
                                                                        </td>
                                                                        <td style="padding: 4px 5px; text-align: center; border-bottom: 1px solid #fce4ec; font-weight: bold;">
                                                                            <t t-esc="bad.quantity"/>
                                                                        </td>
                                                                        <td style="padding: 4px 5px; text-align: right; border-bottom: 1px solid #fce4ec;">
                                                                            <t t-if="line.is_usd_account">$ </t>
                                                                            <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                                            <t t-esc="'{:,.2f}'.format(bad.total)"/>
                                                                        </td>
                                                                    </tr>
                                                                </t>
                                                            </tbody>
                                                            <tfoot>
                                                                <tr style="background-color: #f8bbd9; font-weight: bold;">
                                                                    <td colspan="3" style="padding: 6px; text-align: right;">TOTAL MAL ESTADO:</td>
                                                                    <td style="padding: 6px; text-align: right; color: #e74c3c;">
                                                                        <t t-if="line.is_usd_account">$ </t>
                                                                        <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                                        <t t-esc="'{:,.2f}'.format(line.total_bad_bills)"/>
                                                                        <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                                                    </td>
                                                                </tr>
                                                            </tfoot>
                                                        </table>
                                                    </t>
                                                    <t t-else="">
                                                        <p style="color: #7f8c8d; font-style: italic; font-size: 9px; margin: 0;">Sin billetes en mal estado</p>
                                                    </t>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                    
                                    <!-- Resumen total de la cuenta -->
                                    <div style="background-color: #f5f5f5; padding: 10px; border-radius: 6px; margin-top: 10px; border: 2px solid #2c3e50;">
                                        <table style="width: 100%; font-size: 10px;">
                                            <tr>
                                                <td style="width: 33%; text-align: center;">
                                                    <span style="color: #7f8c8d;">Denominaciones:</span><br/>
                                                    <strong style="color: #27ae60;">
                                                        <t t-if="line.is_usd_account">$ </t>
                                                        <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                        <t t-esc="'{:,.2f}'.format(sum(line.denomination_line_ids.mapped('total')))"/>
                                                        <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                                    </strong>
                                                </td>
                                                <td style="width: 33%; text-align: center;">
                                                    <span style="color: #7f8c8d;">+ Mal Estado:</span><br/>
                                                    <strong style="color: #e74c3c;">
                                                        <t t-if="line.is_usd_account">$ </t>
                                                        <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                        <t t-esc="'{:,.2f}'.format(line.total_bad_bills)"/>
                                                        <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                                    </strong>
                                                </td>
                                                <td style="width: 33%; text-align: center; background-color: #2c3e50; color: white; padding: 8px; border-radius: 4px;">
                                                    <span style="font-size: 9px;">= TOTAL CONTADO:</span><br/>
                                                    <strong style="font-size: 14px;">
                                                        <t t-if="line.is_usd_account">$ </t>
                                                        <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                        <t t-esc="'{:,.2f}'.format(line.counted_amount)"/>
                                                        <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                                    </strong>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>
                </div>

                <!-- ================================= -->
                <!-- MOVIMIENTOS POR CUENTA           -->
                <!-- ================================= -->
                <t t-foreach="doc.line_ids" t-as="line">
                    <div style="page-break-inside: avoid; margin-top: 30px;">
                        <!-- Encabezado de la cuenta -->
                        <div t-attf-style="background-color: #{line.is_usd_account and '#e8f5e9' or (line.is_eur_account and '#f3e5f5' or '#e3f2fd')}; 
                                          border-left: 5px solid #{line.is_usd_account and '#27ae60' or (line.is_eur_account and '#9b59b6' or '#3498db')}; 
                                          padding: 12px 15px; border-radius: 0 8px 8px 0; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span style="font-size: 14px; font-weight: bold; color: #2c3e50;">
                                        <t t-esc="line.account_id.code"/> - <t t-esc="line.account_id.name"/>
                                    </span>
                                    <span t-if="line.is_usd_account" 
                                          style="background-color: #27ae60; color: white; padding: 2px 10px; border-radius: 10px; font-size: 10px; margin-left: 10px;">
                                        USD
                                    </span>
                                    <span t-elif="line.is_eur_account" 
                                          style="background-color: #9b59b6; color: white; padding: 2px 10px; border-radius: 10px; font-size: 10px; margin-left: 10px;">
                                        EUR
                                    </span>
                                    <span t-else="" 
                                          style="background-color: #3498db; color: white; padding: 2px 10px; border-radius: 10px; font-size: 10px; margin-left: 10px;">
                                        Bs
                                    </span>
                                </div>
                                <div style="text-align: right; font-size: 11px; color: #7f8c8d;">
                                    Saldo Final: 
                                    <strong t-attf-style="color: #{line.is_usd_account and '#27ae60' or (line.is_eur_account and '#9b59b6' or '#3498db')};">
                                        <t t-if="line.is_usd_account">$ </t>
                                        <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                        <t t-esc="'{:,.2f}'.format(line.final_balance)"/>
                                        <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                    </strong>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabla de movimientos -->
                        <t t-set="movements" t-value="line.get_movements_for_report()"/>
                        <t t-if="movements">
                            <table style="width: 100%; border-collapse: collapse; font-size: 10px; margin-bottom: 10px;">
                                <thead>
                                    <tr style="background-color: #f8f9fa;">
                                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Fecha</th>
                                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Empresa/Cliente</th>
                                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Etiqueta</th>
                                        <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">Monto</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="movements" t-as="move">
                                        <tr t-attf-style="background-color: #{move_odd and '#ffffff' or '#f8f9fa'};">
                                            <td style="padding: 6px 8px; border-bottom: 1px solid #e9ecef;">
                                                <t t-esc="move.get('date')"/>
                                            </td>
                                            <td style="padding: 6px 8px; border-bottom: 1px solid #e9ecef;">
                                                <t t-esc="move.get('partner', '-')"/>
                                            </td>
                                            <td style="padding: 6px 8px; border-bottom: 1px solid #e9ecef;">
                                                <t t-esc="move.get('name', '')"/>
                                            </td>
                                            <td style="padding: 6px 8px; border-bottom: 1px solid #e9ecef; text-align: right;"
                                                t-attf-style="color: #{move.get('amount', 0) &gt;= 0 and '#27ae60' or '#e74c3c'}; font-weight: bold;">
                                                <t t-if="line.is_usd_account">$ </t>
                                                <t t-elif="line.is_eur_account">‚Ç¨ </t>
                                                <t t-esc="'{:,.2f}'.format(move.get('amount', 0))"/>
                                                <t t-if="not line.is_usd_account and not line.is_eur_account"> Bs</t>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-else="">
                            <div style="padding: 15px; background-color: #f8f9fa; border-radius: 5px; text-align: center; color: #7f8c8d; font-style: italic;">
                                No hay movimientos para esta cuenta en la fecha seleccionada.
                            </div>
                        </t>
                    </div>
                </t>

                <!-- Tabla de Totales - Tres columnas para Bs, USD y EUR -->
                <div style="margin-top: 25px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <!-- Totales Bs -->
                            <td style="width: 33.33%; padding: 5px; vertical-align: top;">
                                <div style="background-color: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #27ae60;">
                                    <h4 style="margin: 0 0 10px 0; color: #27ae60; font-size: 12px;">üí∞ Totales Bol√≠vares</h4>
                                    <table style="width: 100%; font-size: 11px;">
                                        <tr><td>Inicial:</td><td style="text-align: right;"><strong><t t-esc="'{:,.2f}'.format(doc.total_initial_balance_bs)"/> Bs</strong></td></tr>
                                        <tr><td>Ingresos:</td><td style="text-align: right; color: #27ae60;"><strong>+<t t-esc="'{:,.2f}'.format(doc.total_income_bs)"/> Bs</strong></td></tr>
                                        <tr><td>Egresos:</td><td style="text-align: right; color: #e74c3c;"><strong>-<t t-esc="'{:,.2f}'.format(doc.total_expense_bs)"/> Bs</strong></td></tr>
                                        <tr style="border-top: 1px solid #ccc;"><td>Final:</td><td style="text-align: right;"><strong><t t-esc="'{:,.2f}'.format(doc.total_final_balance_bs)"/> Bs</strong></td></tr>
                                        <tr><td>Contado:</td><td style="text-align: right;"><strong><t t-esc="'{:,.2f}'.format(doc.total_counted_bs)"/> Bs</strong></td></tr>
                                        <tr><td>Diferencia:</td><td style="text-align: right;"><strong><t t-esc="'{:,.2f}'.format(doc.total_difference_bs)"/> Bs</strong></td></tr>
                                    </table>
                                </div>
                            </td>
                            <!-- Totales USD -->
                            <td style="width: 33.33%; padding: 5px; vertical-align: top;">
                                <div style="background-color: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                                    <h4 style="margin: 0 0 10px 0; color: #3498db; font-size: 12px;">üíµ Totales D√≥lares</h4>
                                    <table style="width: 100%; font-size: 11px;">
                                        <tr><td>Inicial:</td><td style="text-align: right;"><strong>$ <t t-esc="'{:,.2f}'.format(doc.total_initial_balance_usd)"/></strong></td></tr>
                                        <tr><td>Ingresos:</td><td style="text-align: right; color: #27ae60;"><strong>+$ <t t-esc="'{:,.2f}'.format(doc.total_income_usd)"/></strong></td></tr>
                                        <tr><td>Egresos:</td><td style="text-align: right; color: #e74c3c;"><strong>-$ <t t-esc="'{:,.2f}'.format(doc.total_expense_usd)"/></strong></td></tr>
                                        <tr style="border-top: 1px solid #ccc;"><td>Final:</td><td style="text-align: right;"><strong>$ <t t-esc="'{:,.2f}'.format(doc.total_final_balance_usd)"/></strong></td></tr>
                                        <tr><td>Contado:</td><td style="text-align: right;"><strong>$ <t t-esc="'{:,.2f}'.format(doc.total_counted_usd)"/></strong></td></tr>
                                        <tr><td>Diferencia:</td><td style="text-align: right;"><strong>$ <t t-esc="'{:,.2f}'.format(doc.total_difference_usd)"/></strong></td></tr>
                                    </table>
                                </div>
                            </td>
                            <!-- Totales EUR -->
                            <td style="width: 33.33%; padding: 5px; vertical-align: top;">
                                <div style="background-color: #f3e5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #9b59b6;">
                                    <h4 style="margin: 0 0 10px 0; color: #9b59b6; font-size: 12px;">üí∂ Totales Euros</h4>
                                    <table style="width: 100%; font-size: 11px;">
                                        <tr><td>Inicial:</td><td style="text-align: right;"><strong>‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_initial_balance_eur)"/></strong></td></tr>
                                        <tr><td>Ingresos:</td><td style="text-align: right; color: #27ae60;"><strong>+‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_income_eur)"/></strong></td></tr>
                                        <tr><td>Egresos:</td><td style="text-align: right; color: #e74c3c;"><strong>-‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_expense_eur)"/></strong></td></tr>
                                        <tr style="border-top: 1px solid #ccc;"><td>Final:</td><td style="text-align: right;"><strong>‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_final_balance_eur)"/></strong></td></tr>
                                        <tr><td>Contado:</td><td style="text-align: right;"><strong>‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_counted_eur)"/></strong></td></tr>
                                        <tr><td>Diferencia:</td><td style="text-align: right;"><strong>‚Ç¨ <t t-esc="'{:,.2f}'.format(doc.total_difference_eur)"/></strong></td></tr>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- ================================= -->
                <!-- CUENTAS BANCARIAS                 -->
                <!-- ================================= -->
                <t t-if="doc.bank_line_ids">
                    <div style="margin-top: 25px; margin-bottom: 20px;">
                        <div style="background-color: #1a5276; color: white; padding: 10px 15px; font-weight: bold; border-radius: 8px 8px 0 0;">
                            üè¶ Saldos de Cuentas Bancarias
                        </div>
                        <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
                            <thead>
                                <tr style="background-color: #f5f5f5;">
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: left; font-size: 11px;">Cuenta</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center; font-size: 11px;">Moneda</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: right; font-size: 11px;">Saldo de Cierre</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: left; font-size: 11px;">Notas</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.bank_line_ids" t-as="bank_line">
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 8px; font-size: 10px;">
                                            <t t-esc="bank_line.account_id.code"/> - <t t-esc="bank_line.account_id.name"/>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 10px;">
                                            <t t-esc="bank_line.currency_id.name or 'Bs'"/>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right; font-size: 11px; font-weight: bold;">
                                            <t t-esc="'{:,.2f}'.format(bank_line.closing_balance)"/>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 8px; font-size: 10px; color: #666;">
                                            <t t-esc="bank_line.notes or '-'"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>

                <!-- Observaciones -->
                <t t-if="doc.notes">
                    <div style="margin-top: 25px; padding: 15px; background-color: #e8f4f8; border-radius: 8px; border-left: 5px solid #3498db;">
                        <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #2c3e50;">üìù Observaciones</h4>
                        <div style="font-size: 11px;"><t t-raw="doc.notes"/></div>
                    </div>
                </t>

                <!-- ================================= -->
                <!-- SECCI√ìN DE FIRMAS                 -->
                <!-- ================================= -->
                <div style="margin-top: 40px; page-break-inside: avoid;">
                    <h4 style="font-size: 14px; color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">‚úçÔ∏è Firmas de Autorizaci√≥n</h4>
                    
                    <table style="width: 100%; margin-top: 30px;">
                        <tr>
                            <!-- Firma del Cajero/Responsable -->
                            <td style="width: 45%; text-align: center; vertical-align: bottom; padding: 0 20px;">
                                <div style="border-bottom: 2px solid #2c3e50; padding-bottom: 5px; margin-bottom: 10px; min-height: 80px;">
                                    <t t-if="doc.closed_signature">
                                        <img t-att-src="'data:image/png;base64,' + doc.closed_signature.decode('utf-8')" 
                                             style="max-height: 70px; max-width: 200px;"/>
                                    </t>
                                </div>
                                <div style="font-weight: bold; color: #2c3e50; font-size: 12px;">
                                    <t t-esc="doc.user_id.name"/>
                                </div>
                                <div style="font-size: 10px; color: #7f8c8d;">Responsable del Cierre</div>
                                <div style="font-size: 9px; color: #95a5a6; margin-top: 5px;">
                                    Fecha: 
                                    <t t-if="doc.closed_date">
                                        <t t-esc="doc.closed_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                    </t>
                                    <t t-else="">_______________</t>
                                </div>
                            </td>
                            
                            <td style="width: 10%;"></td>
                            
                            <!-- Firma del Supervisor/Confirmador -->
                            <td style="width: 45%; text-align: center; vertical-align: bottom; padding: 0 20px;">
                                <div style="border-bottom: 2px solid #2c3e50; padding-bottom: 5px; margin-bottom: 10px; min-height: 80px;">
                                    <t t-if="doc.confirmed_signature">
                                        <img t-att-src="'data:image/png;base64,' + doc.confirmed_signature.decode('utf-8')" 
                                             style="max-height: 70px; max-width: 200px;"/>
                                    </t>
                                </div>
                                <div style="font-weight: bold; color: #2c3e50; font-size: 12px;">
                                    <t t-if="doc.confirmed_by_id">
                                        <t t-esc="doc.confirmed_by_id.name"/>
                                    </t>
                                    <t t-else="">_________________________</t>
                                </div>
                                <div style="font-size: 10px; color: #7f8c8d;">Supervisor / Confirmaci√≥n</div>
                                <div style="font-size: 9px; color: #95a5a6; margin-top: 5px;">
                                    Fecha: 
                                    <t t-if="doc.confirmed_date">
                                        <t t-esc="doc.confirmed_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                    </t>
                                    <t t-else="">_______________</t>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Footer -->
                <div style="margin-top: 30px; padding-top: 15px; border-top: 2px solid #e0e0e0; font-size: 9px; color: #7f8c8d;">
                    <table style="width: 100%;">
                        <tr>
                            <td style="width: 50%;">
                                Generado el <t t-esc="datetime.datetime.now().strftime('%d/%m/%Y %H:%M')"/> 
                                por <t t-esc="env.user.name"/>
                            </td>
                            <td style="width: 50%; text-align: right;">
                                <t t-esc="doc.company_id.name"/> - Sistema de Cierre de Caja
                            </td>
                        </tr>
                    </table>
                </div>

            </div>
        </t>
    </template>
</odoo>
